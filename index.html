<!DOCTYPE html>
<html>
<head>
    <title>StoryTeller M√°gico ‚ú®</title>
    <style>
        body { font-family: 'Comic Sans MS'; background: linear-gradient(45deg, #ff6b6b, #4ecdc4); }
        .container { max-width: 600px; margin: 50px auto; padding: 30px; background: white; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        button { background: #ff6b6b; color: white; border: none; padding: 15px 30px; border-radius: 50px; font-size: 18px; cursor: pointer; }
        .story-page { margin: 20px 0; text-align: center; }
        img { max-width: 100%; border-radius: 15px; margin: 10px 0; }
        audio { width: 100%; margin: 10px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé≠ StoryTeller M√°gico</h1>
        
        <div id="input-form">
            <input id="childName" placeholder="Nombre del ni√±o" style="width:100%; padding:15px; margin:10px 0; border-radius:10px;">
            <input id="age" type="number" placeholder="Edad" style="width:100%; padding:15px; margin:10px 0; border-radius:10px;">
            <input id="character" placeholder="Personaje (ej: drag√≥n)" style="width:100%; padding:15px; margin:10px 0; border-radius:10px;">
            <input id="theme" placeholder="Tema (ej: Azure)" style="width:100%; padding:15px; margin:10px 0; border-radius:10px;">
            <button onclick="generateStory()">‚ú® Generar Cuento M√°gico</button>
        </div>

        <div id="loading" style="display:none;">
            <h2>üé® La IA est√° creando magia...</h2>
            <div style="font-size:50px;">‚ú®‚ú®‚ú®</div>
        </div>

        <div id="story" style="display:none;"></div>
    </div>

    <script>
        let currentPage = 0;
        let storyData = null;

        async function generateStory() {
            const name = document.getElementById('childName').value || 'amigo';
            const age = document.getElementById('age').value || 6;
            const character = document.getElementById('character').value || 'unicornio';
            const theme = document.getElementById('theme').value || 'magia';

            document.getElementById('input-form').style.display = 'none';
            document.getElementById('loading').style.display = 'block';

            try {
                const response = await fetch('/api/generate-story', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, age: parseInt(age), character, theme })
                });

                storyData = await response.json();
                showStory();
            } catch (error) {
                alert('¬°Error m√°gico! Intenta de nuevo ‚ú®');
                document.getElementById('input-form').style.display = 'block';
                document.getElementById('loading').style.display = 'none';
            }
        }

        function showStory() {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('story').style.display = 'block';
            showPage(0);
        }

        function showPage(page) {
            currentPage = page;
            const storyDiv = document.getElementById('story');
            
            if (page < storyData.pages.length) {
                const pageData = storyData.pages[page];
                storyDiv.innerHTML = `
                    <div class="story-page">
                        <h2>P√°gina ${page + 1}</h2>
                        <img src="${pageData.image}" alt="P√°gina ${page + 1}">
                        <p>${pageData.text}</p>
                        <audio controls>
                            <source src="${pageData.audio}" type="audio/mpeg">
                        </audio>
                        <div style="margin:20px 0;">
                            <button onclick="showPage(${page - 1})" ${page === 0 ? 'disabled' : ''}>‚Üê Anterior</button>
                            <button onclick="showPage(${page + 1})" ${page === storyData.pages.length - 1 ? 'disabled' : ''}>Siguiente ‚Üí</button>
                        </div>
                    </div>
                `;
            }
        }
    </script>
</body>
</html>
